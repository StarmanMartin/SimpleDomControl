(()=>{"use strict";const t=sdc_client;class SdcSearchSelectController extends t.AbstractSDC{constructor(){super(),this.contentUrl="/sdc_view/sdc_tools/sdc_search_select",this._state=0,this._searchIdx={},this._searchtimer=null,this._currentOption=[],this.startValues=[],this.value=[],this._allowDelete=!1,this.model=null,this.events.unshift({click:{".option-container":function(t){this.onSelect(t)}}})}onInit(t="unknown",e,i=[""],s,n,r){this.required=Boolean("true"===e?.toLocaleLowerCase()),this.multi=Boolean("true"===n?.toLocaleLowerCase()),this._allowDelete=!this.required||this.multi,this.startValues=i instanceof Array?i:JSON.parse(i.replaceAll("'",'"')),this.name=t,s&&(this.model=r?this.newModel(s,{pk__in:r}):this.newModel(s))}onLoad(t){if(!this.model){let e=this;const i=$('<div class="all-option-container"></div>');t.find(".main-select-options").append(i),this.find(".option-container").each((function(){e._prepareOption(this),i.append(this)}))}return super.onLoad(t)}willShow(){return this.model?new Promise((t=>{const e=this,i=this.model.view({viewName:"html_select_template",cbResolve:()=>{e.find(".option-container").each((function(){e._prepareOption(this)})),t(super.willShow())}});i.removeClass("container-fluid").addClass("all-option-container"),this.find(".main-select-options").append(i)})):super.willShow()}_prepareOption(t){const e=$(t),i=String(e.data("value")),s=i.replace(/[^a-zA-Z0-9_-]+/g,"__");this._searchIdx[s]=e.data("search").toLowerCase().split(",").map((t=>t.replaceAll(" ",""))),this._searchIdx[s].push(e.data("search")),e.addClass(`oc-${s}`).addClass("oc-style"),this.startValues.includes(i)&&this._storeSelectedOption(e)}onRefresh(){return 1===this._state?(setTimeout((()=>this.find(".search-term-input").focus()),100),this.find(".main-select-options").addClass("active").find(".search-term-input").val(""),this.find(".option-container").addClass("found")):this.find(".main-select-options").removeClass("active"),super.onRefresh()}current_val(){if(0===this._state){const content=()=>{if(0===this.value.length)return sdcDom("input",{type:"hidden",className:"timer-change",name:this.name,value:""});{let t;return t=this.multi?`[${this.value.join(",")}]`:this.value[0],sdcDom("div",{className:this.multi?"multi":""},this._currentOption,sdcDom("input",{className:"timer-change",type:"hidden",name:this.name,value:t}))}};return sdcDom("div",null,sdcDom("p",{sdc_click:"onActivate",className:"mb-2 custom-select form-control"},sdcDom("span",{className:"select-label"},gettext("Search & select...")),sdcDom("span",{className:"select-arrow"})),content())}}onActivate(){this._state=1,this.refresh()}onDeactivate(t,e){const i=document.elementFromPoint(e.clientX,e.clientY);$(i).hasClass("background-event")&&this._deactivate()}_deactivate(){return new Promise((t=>{setTimeout((()=>{this._state=0,t(this.refresh())}),100)}))}_storeSelectedOption(t){const e=t.clone()[0];t.addClass("selected"),Array.from(e.attributes).forEach((t=>e.removeAttribute(t.name))),e.className="selected-option";const i=String(t.data("value"));if(this._allowDelete){const t=$('<button type="button" sdc_click="remove_selection" class="delete-btn" aria-label="Remove Bouldering">&times;</button>');t.data("value",i),e.append(t[0])}this.multi?this.value.includes(i)||(this.value.push(i),this._currentOption.push(e)):(this.value=[i],this._currentOption=[e])}remove_selection(t){const e=this.value.indexOf(t.data("value"));this.value.splice(e,1),this._currentOption.splice(e,1),this.refresh().then((()=>{this.find(".timer-change").trigger("change")}))}onSelect(t){this._storeSelectedOption(t),this._deactivate().then((()=>{this.find(".timer-change").trigger("change")}))}updateSearch(t){this._searchtimer&&clearTimeout(this._searchtimer),this._searchtimer=setTimeout((()=>{this.find(".option-container").removeClass("found");const e=t.val().toLowerCase().split(/[,\s]+/);e&&Object.entries(this._searchIdx).forEach((([t,i])=>{e.every((t=>i.some((e=>e.includes(t)))))&&this.find(`.oc-${t}`).addClass("found")}))}),500)}}t.app.register(SdcSearchSelectController),SdcSearchSelectController.prototype._on_init_params=function(){return["name","required","value","modelName","multiple","ids"]};class SdcDummyController extends t.AbstractSDC{constructor(){super(),this.contentUrl="/sdc_view/sdc_tools/sdc_dummy"}onInit(t){this._text=t}onLoad(t){return t.find(".origen_content").append(this.$container.html()),super.onLoad(t)}willShow(){return super.willShow()}onRefresh(){return super.onRefresh()}page_text(){return sdcDom("p",{className:"col"},this._text||"")}}t.app.register(SdcDummyController),SdcDummyController.prototype._on_init_params=function(){return["text"]};class SdcAutoSubmitController extends t.AbstractSDC{constructor(){super(),this.events.unshift({submit:{".ajax-form":function(e,i){i.preventDefault();const s=e[0];this.submitForm(s).then((e=>{(e.msg||e.header)&&(0,t.trigger)("pushMsg",e.header||"",e.msg||""),(0,t.clearErrorsInForm)($(s)),this.onSubmit(e)})).catch((i=>{let s=i.responseJSON;s&&(s.html&&(0,t.setErrorsInForm)(e,$(s.html)),(s.msg||s.header)&&(0,t.trigger)("pushErrorMsg",s.header||"",s.msg||"")),this.onErrorSubmit(i)}))}}})}onInit(){}onLoad(t){return super.onLoad(t)}willShow(){return super.willShow()}onRefresh(){return super.onRefresh()}onSubmit(){}onErrorSubmit(){}onChange(t){t.closest(".ajax-form").submit()}}t.app.register(SdcAutoSubmitController);class SdcErrorController extends t.AbstractSDC{constructor(){super(),this.contentUrl="/sdc_view/sdc_tools/sdc_error/%(code)s"}onInit(){}onLoad(t){return t.find(".error_content").append(this.$container.html()),super.onLoad(t)}willShow(){return super.willShow()}onRefresh(){return super.onRefresh()}}t.app.register(SdcErrorController);class SdcNavigationClientController extends t.AbstractSDC{constructor(){super(),this.menu_id=0,this._navController=null}onInit(){}onLoad(e){return(0,t.on)("_onResize",this),super.onLoad(e)}willShow(){return this.confirmPageLoaded(),super.willShow()}_onResize(){this.onResize()}onResize(){}confirmPageLoaded(){(0,t.trigger)("navLoaded",this),(0,t.trigger)("changeMenu",this.menu_id)}get navController(){return this._navController?.deref()}get activeController(){return this._navController?.deref().activeController}get navControllerPath(){return this._navController?.deref()._origin_target}}t.app.register(SdcNavigationClientController);class SdcAlertMessengerController extends t.AbstractSDC{constructor(){super(),this.contentUrl="/sdc_view/sdc_tools/sdc_alert_messenger",this.msgCounter=0}onInit(){}onLoad(e){return(0,t.on)("pushMsg",this),(0,t.on)("pushErrorMsg",this),super.onLoad(e)}willShow(){return super.willShow()}onRefresh(){return super.onRefresh()}pushMsg(t,e){return this._pushMsg(t,e,!1)}pushErrorMsg(t,e){return this._pushMsg(t,e,!0)}_pushMsg(t,e,i){"string"==typeof e&&(e=[e]),this._pushMsgArray(t,e,i)}_pushMsgArray(t,e,i){let s=this.find(".dummy_row");if(0===s.length)return;let n=s.clone();n.removeClass("dummy_row"),i&&n.addClass("error_box"),n.find(".msg_header").text(t),n.find(".msg_body")[0].innerHTML=e;let r=new Date,o=r.getMinutes();o=o<10?"0"+o:o,n.find(".msg_date").text(r.getHours()+":"+o),n.insertAfter(s);let a=this;var l;this.msgCounter++,this.find(".alert_msg_container").addClass("active"),l=n,setTimeout((()=>{l.remove(),a.msgCounter--,0===a.msgCounter&&a.find(".alert_msg_container").removeClass("active")}),2e3)}}t.app.registerGlobal(SdcAlertMessengerController);class SdcUpdateOnChangeController extends t.AbstractSDC{constructor(){super(),this._timer=null,this.isAutoChange=!0,this._isNotReady=!0,this._isChanged=!1,this._lastTimeChanged="",this.events.unshift({change:{".timer-change":this.change},keydown:{".timer-change":this.startTimer}})}onInit(){}onLoad(t){return super.onLoad(t)}willShow(){return this._isNotReady=!0,super.willShow()}onRefresh(){return setTimeout((()=>{this._isNotReady=!1}),500),super.onRefresh()}change(t){this.isAutoChange&&!this._isNotReady&&(this._timer&&(clearTimeout(this._timer),this._timer=null),!this._lastTimeChanged!==t.name&&(this.onChange($(t)),this._isChanged=!0,this._lastTimeChanged=""))}startTimer(t){this.isAutoChange&&!this._isNotReady&&(this._timer&&(clearTimeout(this._timer),this._timer=null),this._lastTimeChanged="",this._isChanged=!1,this._timer=setTimeout((()=>{this._isChanged||(this.onChange($(t)),this._lastTimeChanged=t.name)}),1e3))}}t.app.register(SdcUpdateOnChangeController);class SdcSearchViewController extends t.AbstractSDC{constructor(){super(),this.contentUrl="/sdc_view/sdc_tools/sdc_search_view",this.isRange=!0,this.isTotalCount=!0,this.dataIdxKey="next-idx",this.id=`${(new Date).getTime()}_${Math.random().toString(36).substring(7)}`,this.$form=null,this.events.unshift({submit:{".search-form":(t,e)=>{e.preventDefault()}},click:{".page-number-control-btn":function(t){this.$form[0].range_start.value=$(t).data(this.dataIdxKey),this.onChange()}}})}onInit(t,e,i,s,n,r){this.url=t||"",void 0===i||void 0===s?this.isRange=!1:(void 0===e&&(e=s-i),void 0===n&&(this.isTotalCount=!1),this.totalCount=n,this.rangeSize=e,this.range=[i-e-1,i,s],i<=1&&s>=n&&(this.isRange=!1)),this.removeLabels=r||!1}onLoad(t){return this.$form=$(document.createElement("form")),t.find(".inner-form.search-form").append(this.$container.html()),this.$form.append(this.$container.html()),this.$form.attr("action",this.url),this.$form.attr("method","post"),this.$form.attr("id",this.id),super.onLoad(t)}willShow(){let t=this.find(".page-number-control");return this.find(".form-group").addClass("form-group-sm"),this.removeLabels&&(this.find(".form-input-container").removeClass("col-md-7"),this.find(".form-group").addClass("no-label")),this.isRange?(t.find(".range-span").text(this.range[1]+" - "+this.range[2]),this.isTotalCount?t.find(".total-amount-span").text(" / "+this.totalCount):t.find(".total-amount-span").remove(),this.range[1]>1?t.find(".page-number-control-btn-prev").data(this.dataIdxKey,this.range[0]):t.find(".page-number-control-btn-prev").addClass("disabled").prop("disabled",!0),this.range[2]<this.totalCount?t.find(".page-number-control-btn-next").data(this.dataIdxKey,this.range[2]):t.find(".page-number-control-btn-next").addClass("disabled").prop("disabled",!0),super.willShow()):(t.remove(),super.willShow())}onRefresh(){return super.onRefresh()}onChange(){let t=this.find(".inner-form.search-form");this.$form.find(".form-control").each((function(){if(""!==this.id){let e=t.find(`#${this.id}`);if("SELECT"===this.tagName){let t=$(this);t.empty(),t.append(`<option value="${e.val()}" selected">`)}else $(this).val(e.val())}})),this._parentController.onSearch?this._parentController.onSearch(this.$form[0]):console.error("SearchController parent needs to implement onSearch(form)")}}t.app.register(SdcSearchViewController).addMixin("sdc-update-on-change"),SdcSearchViewController.prototype._on_init_params=function(){return["url","rangeSize","rangeStart","rangeEnd","totalCount","removeLabels"]};class SdcDetailViewController extends t.AbstractSDC{constructor(){super(),this.contentUrl="/sdc_view/sdc_tools/sdc_detail_view",this.template_context=null,this.model=null}onInit(t,e){this.model||(t&&void 0!==e||console.error("You have to set data-model and data-pk in the <sdc-detail-view> tag!"),this.model=this.newModel(t,{pk:e}))}onLoad(t){const e=this.model.detailView(null,(()=>{this.find(".detail-container").append(e),this.refresh(),this._onUpdate.bind(this)}),null,this.template_context);return this.model.on_update=this.model.on_create=async()=>{await this._updateView(),this._onUpdate()},super.onLoad(t)}willShow(){return super.willShow()}onRefresh(){return this.find('[data-bs-toggle="tooltip"]').each((function(){new Tooltip(this)})),super.onRefresh()}removeInstance(t,e){this.model.delete()}_onUpdate(){this.on_update&&this.model.load().then((()=>{this.on_update(this.model.values_list)}))}_updateView(){return new Promise((e=>{const i=this.model.listView(this.search_values,(()=>{$(".tooltip.fade.show").remove(),t.app.reconcile(this,i,this.find(".detail-container").children()),e()}),null,this.template_context)}))}}t.app.register(SdcDetailViewController),SdcDetailViewController.prototype._on_init_params=function(){return["model","pk"]};class SdcModelFormController extends t.AbstractSDC{constructor(){super(),this.pk=null,this.contentUrl="/sdc_view/sdc_tools/sdc_model_form",this.model_name=null,this.isKeepEditing=null,this.isReset=null,this._isLoaded=!1,this.autoSave=null,this.model=null,this.formHeader=null,this.buttonText=null}async onInit(t,e,i,s,n,r,o,a,l=!1,h=!1,d=!1,c=!0){!this.on_update&&(this.on_update=n),!this.on_error&&(this.on_error=r),!this.next&&(this.next=i),null===this.buttonText&&a?this.buttonText=a:this.buttonText=gettext("Save"),null===this.formHeader&&(this.formHeader=o),null===this.autoSave&&(this.autoSave=c),null===this.isReset&&(this.isReset=h),null===this.isKeepEditing&&(this.isKeepEditing=d),"function"==typeof s&&(s=s()),t instanceof Promise&&(t=await t),"object"==typeof t&&"Model"===t.constructor.name&&(this.model=t),this.model&&this.model.values?.pk>0?e=this.model.values.pk:this.model_name&&(t=this.model_name),this.form_name||=l,this.form_name?(this.isAutoChange=this.autoSave,this.pk=e,this.type="edit",this.model??=this.newModel(t,{pk:e}),this.form_generator=()=>this.model.namedForm(e,this.form_name,this._onFormLoaded.bind(this))):void 0!==e?(this.isAutoChange=!0,this.pk=e,this.type="edit",this.model??=this.newModel(t,{pk:e}),this.form_generator=()=>this.model.editForm(-1,this._onFormLoaded.bind(this))):(this.isAutoChange=!1,this.type="create",this.model??=this.newModel(t),this.form_generator=()=>this.model.createForm(this._onFormLoaded.bind(this))),"object"==typeof s&&this.model.filter(s)}onLoad(t){return this.form=this.form_generator().addClass("container-fluid"),t.find(".form-container").append(this.form),super.onLoad(t)}onChange(){this.form?.closest("form").submit()}willShow(){return super.willShow()}onRefresh(){return super.onRefresh()}_onFormLoaded(){this._isLoaded||this.refresh(),this._isLoaded=!0}_createFormToEditForm(){this.pk=this.model.values.pk,this.type="edit",this.isAutoChange=!0;const t=this.form?.closest("form"),e=t.clone(),i=e.find(".form-container").safeEmpty(),s=this.model.editForm(this.pk,(()=>{this.reconcile(e,t)})).addClass("container-fluid");i.append(s)}submitModelForm(e,i){let s=this;return super.defaultSubmitModelForm(e,i).then((function(i){let n=!0;i&&"create"===i.type&&(n=!1,s.isReset?e[0].reset():s.isKeepEditing?s._createFormToEditForm():(0,t.trigger)("goTo",s.next||"..")),s.on_update&&s.on_update(i),n&&s.next&&(0,t.trigger)("goTo",s.next)})).catch((t=>{s.on_error&&s.on_error(t)}))}controller_name(){return`${this.type.replace(/^./g,(t=>t.toUpperCase()))} ${this.model.model_name.replace(/[A-Z]/g,(t=>" "+t)).replace(/^./g,(t=>t.toUpperCase()))}`}save_btn(){return this._isLoaded?this.autoSave||"edit"!==this.type?sdcDom("span",null):sdcDom("button",{className:"btn btn-success"},this.buttonText):sdcDom("h3",null,gettext("Loading..."))}header_top(){return this.formHeader?sdcDom("h3",null,this.formHeader):sdcDom("span",null)}}t.app.register(SdcModelFormController).addMixin("sdc-update-on-change"),SdcModelFormController.prototype._on_init_params=function(){return["model","pk","next","filter","on_update","on_error","form_header","button_text","form_name","reset_on_save","editing_after_save","auto_save"]};class SdcListViewController extends t.AbstractSDC{constructor(){super(),this.contentUrl="/sdc_view/sdc_tools/sdc_list_view",this.search_values={},this.model_name=null,this.template_context=null}onInit(t,e,i){this.model||(this.model_name&&(t=this.model_name),this.model=this.newModel(t)),i&&(this.on_update=i),"function"==typeof e&&(e=e()),"object"==typeof e&&this.model.filter(e),this.on_update&&this.model.load().then((()=>{this.on_update(this.model.values_list)}))}onLoad(t){let e=t.filter(".list-container");return 0===e.length&&(e=t.find(".list-container")),e.append(this.model.listView(this.search_values,null,null,this.template_context)),this.model.on_update=this.model.on_create=()=>{this.on_update&&this.model.load().then((()=>{this.on_update(this.model.values_list)})),this._updateView()},super.onLoad(t)}willShow(){return super.willShow()}onRefresh(){return this.find('[data-bs-toggle="tooltip"]').each((function(){new Tooltip(this)})),super.onRefresh()}removeInstance(t){this.model.delete(t.data("instance-pk"))}onSearch(t){new FormData(t).forEach(((t,e)=>this.search_values[e]=t)),this._updateView()}_updateView(){const e=this.model.listView(this.search_values,(()=>{$(".tooltip.fade.show").remove(),t.app.reconcile(this,e,this.find(".list-container .container-fluid").first())}),null,this.template_context)}}t.app.register(SdcListViewController),SdcListViewController.prototype._on_init_params=function(){return["model","filter","onUpdate"]};const e="sdc_sub_detail_container",i="sdc_detail_view";class SdcNavigatorController extends t.AbstractSDC{constructor(){super(),this.contentUrl="/sdc_view/sdc_tools/sdc_navigator",this._setup(),this.events.unshift({click:{".navigation-links":function(t,e){e.preventDefault(),this.onNavLink(t,e)}}})}_setup(){this._isLoggedIn=!1,this._history_path=[],this._breadcrumb=[],this._activeContorller=[],this._history_idx=0,this._origin_target=[],this._$detail_view_container=[],this._default_controller=null,this._previous_args=[],this._is_processing=!1,this._process_queue=[],this._current_process=null,this._redirectAfterCurrentProcess=null,this._non_controller_path_prefix="/",this._menu_id=0}onInit(t){this._default_controller=t}onLoad(e){return(0,t.on)("onNavLink",this),(0,t.on)("onNavigateToController",this),(0,t.on)("_RedirectOnView",this),(0,t.on)("goTo",this),(0,t.on)("changeMenu",this),(0,t.on)("navigateToPage",this),(0,t.on)("navLoaded",this),(0,t.on)("login",this),(0,t.on)("logout",this),e.find(".main-nav-import-container").append(this.$container.html()),this._isLoggedIn=e.data("user"),super.onLoad(e)}willShow(){let e=this;$(window).resize((function(){(0,t.trigger)("_onResize",e)})),this._setupButton();let i=this._handleUrl(window.location.pathname);return history.replaceState(i,"",i.url,i),super.willShow()}onRefresh(){return super.onRefresh()}get activeController(){return this._activeContorller}get default_controller(){return this._default_controller?this._default_controller:(console.error(`Set the property data-default-controller in < ${this.tagName}> (tag name of the default controller)`),"")}onNavLink(t,e){e&&e.preventDefault(),this.goTo($(t).attr("href"))}goTo(t,e=null){return t=this._prepareUrl(t),this.onNavigateToController(t,e)}onNavigateToController(t,e=null){if(Array.isArray(t)&&(t=t.join("~")),e){if(Array.isArray(e))e=e.join("&");else if("object"==typeof e){const t=[];for(const[i,s]of Object.entries(e))t.push(`${i}=${s}`);e=t.join("&")}t+="~&"+e}this._pushState(t)}navigateToPage(e,i,s){this._current_process=[e,i],s&&this._updateButton(s.buttonSelector),this._is_processing=!0,this._origin_target=e;let n=this._getSubViewObj(i);if(this._previous_args=i,n.container.container.data("modal")){if(!this._currentModal){this._currentModal=new Modal(n.container.empty_container.closest(n.container.container.data("modal"))[0],{keyboard:!1}),this._currentModal.show(),this._currentModal.off=()=>{this.addEvent("hide.bs.modal",n.container.container.data("modal"),(()=>{}))};const t="/"+"~*".repeat(n.idx);this.addEvent("hide.bs.modal",n.container.container.data("modal"),(()=>{this._currentModal.off(),this.onNavigateToController(t)}))}}else this._currentModal&&(this._currentModal.off(),this._currentModal.hide(),this._currentModal=null);if(n.isBack){n.container.active_sub_container.removeClass("active loading"),n.container.empty_container.addClass("empty").removeClass("active loading"),n.container.active_container.addClass("active").removeClass("empty loading"),n.container.deeper_sub_container.safeEmpty().removeClass("empty loading");let e=t.app.getController(n.container.active_container.find("> ._sdc_controller_"));return this._manageDefault(n.container.active_container),"function"==typeof e.onBack&&e.onBack(),this._is_processing=!1,this._updateBreadcrumb(),this._checkProcessQueue(),void this.refresh()}n.container.empty_container.addClass("loading"),n.container.active_sub_container.addClass("loading"),n.container.active_container.addClass("loading");let r=$(`<${n.target}_sdc-navigation-client></${n.target}_sdc-navigation-client>`);for(let[t,e]of Object.entries(i)){let i=t.split(".");i.length>0&&(t=i.at(-1));const s=t.replace(/([A-Z])/g,(t=>"-"+t.toLowerCase()));(1===i.length||i.length>1&&parseInt(i[0])===n.idx+1)&&r.data(s,e)}n.container.empty_container.safeEmpty().append(r),this.refresh(),this.find(".header-loading").addClass("active"),r.hasClass("_sdc_controller_")||(n.container.empty_container.empty().append('<sdc-error_sdc-navigation-client data-code="404"></sdc-error_sdc-navigation-client>'),this.refresh())}navLoaded(t){let e=this._history_path.length-1,i=this._preparedLastViewContainer(e);i.active_container.removeClass("active loading").addClass("empty"),i.active_sub_container.removeClass("active loading"),i.empty_container.addClass("active").removeClass("empty loading"),i.deeper_sub_container.safeEmpty().removeClass("empty loading"),this._breadcrumb.splice(e),this._activeContorller.splice(e),this._is_processing=!1,$(".tooltip.fade.show").remove(),this._breadcrumb[e]=t.controller_name(),this._activeContorller[e]=t,t._navController=new WeakRef(this),this._origin_target.length!==this._history_path.length?this._current_process&&this.navigateToPage(this._current_process[0],this._current_process[1]):(this._updateBreadcrumb(),this._manageDefault(i.empty_container)||this._checkProcessQueue(),setTimeout((()=>{this.$container.find(".header-loading").removeClass("active")}),100))}_prepareUrl(t){Array.isArray(t)&&(t=t.join("~"));let e=t.split("~").map((t=>t.split("/"))).flat().filter(((t,e)=>e<1||t.length>0));if(!e[0].startsWith(".")&&"*"!==e[0]&&""!==e[0]){for(let t=0;t<this._history_path.length;++t)e.unshift("*");e.unshift("")}return e.join("~").split("~~").join("~")}_checkProcessQueue(){let t=this._process_queue.shift();if(this._current_process=null,t)this._pushState(t[0],t[1]);else if(this._redirectAfterCurrentProcess){const t=this._redirectAfterCurrentProcess;this._redirectAfterCurrentProcess=null,this.goTo(t)}}_RedirectOnView(t){let e=Array(this._history_path.length).fill("~*").join(""),{href:i}=this._handleUrl(e);this._redirectAfterCurrentProcess=$(t).attr("href").replace("next=..",`next=${i}`)}_updateBreadcrumb(){this._breadcrumb.splice(this._history_path.length),this._activeContorller.splice(this._history_path.length);const t=this.find(".breadcrumb"),e=this;t.each((function(){const t=$(this);t.safeEmpty();let i=t.data("offset");i=i?parseInt(i):0;let s=[];e._breadcrumb.length-i-1>0&&(s=Array(e._breadcrumb.length-i-1).fill(".."));for(let n=i;n<e._breadcrumb.length-1;++n)t.append(`<li class="breadcrumb-item"><a class="navigation-links" href="${s.join("~")}">${e._breadcrumb[n]}</a></li>`),s.pop();t.append(`<li class="breadcrumb-item">${e._breadcrumb.at(-1)}</li>`)}))}_preparedLastViewContainer(){let t=this._$detail_view_container.at(-1);const s=this._$detail_view_container.length-1;0===t.length&&console.error(`sdc-navigation only works if you have a <div class="${i}"></div>`),t.hasClass("prepared")||t.addClass("prepared").safeEmpty(),t.hasClass(`prepared${s}`)||t.addClass(`prepared${s}`).append(`<div data-nav-idx="${s}" class="${e} ${s}_${e} empty"></div>`).append(`<div data-nav-idx="${s}" class="${e} ${s}_${e} active"></div>`);let n=t.find(`> .${s}_${e}`).eq(1),r=t.find(`> .${s}_${e}`).first();return r.hasClass("empty")||([r,n]=[n,r]),{container:t,empty_container:r,active_container:n,active_sub_container:t.find(`.${e}.active`).filter((function(){return parseInt($(this).data("nav-idx"))!==s})),deeper_sub_container:t.find(`.${e}`).filter((function(){return parseInt($(this).data("nav-idx"))>s}))}}_getViewContainer(t=0){0===this._$detail_view_container.length&&this._$detail_view_container.push(this.find(`.${i}`)),this._$detail_view_container.splice(t+1).map((t=>t.addClass("sdc_nav_to_remove").find(`> .${e}`).addClass("loading")));let s=this._preparedLastViewContainer();if(this._$detail_view_container.length!==t+1){let t=s.active_container.find(`.${i}`);0!==t.length?this._$detail_view_container.push(t.first()):this._$detail_view_container.push(this._$detail_view_container.at(-1)),s=this._preparedLastViewContainer()}return s}_getSubViewObj(t){const e=this._origin_target;let i=0,s=!1;for(;i<Math.min(e.length,this._history_path.length)&&e[i]===this._history_path[i];)i++;return i>=e.length&&e[i-1]===this._history_path[i-1]?(i=e.length-1,s=e.length<this._history_path.length&&_.isMatch(this._previous_args,t),this._history_path=[...e]):i>=e.length?(i=e.length-1,this._history_path=[...e]):this._history_path=[...e].slice(0,i+1),{idx:i,container:this._getViewContainer(i),target:e[i],isBack:s}}changeMenu(t){t>0&&this._menu_id!==t&&(this._menu_id=t,this.find(".nav-menu-set").removeClass("active"),this.find(`.nav-menu-set.menu-${t}`).addClass("active"))}_setupButton(){let t=this;this.find(".navigation-links").each((function(){let e=$(this);if(!this.hasAttribute("href"))return;e.hasClass("_link-done")||(e.data("_origin_href",t._prepareUrl(e.attr("href"))),e.addClass("_link-done")),e.addClass("_link-done");let i=t._handleUrl(e.data("_origin_href"));e.attr("href",i.href),e.addClass(`nav-family-${i.path.at(-1)}`)}))}_updateButton(t){let e;return t&&(this._currentButton=t),e=this.find(this._currentButton.join(", ")),e&&(this.find(".navigation-links").removeClass("active"),e.addClass("active")),this._isLoggedIn?(this.find(".navigation-links.only-logged-in").show(),this.find(".navigation-links.only-logged-out").hide()):(this.find(".navigation-links.only-logged-in").hide(),this.find(".navigation-links.only-logged-out").show()),e}_handleUrl(t){let e,i,s,n=t.match(/[&?]/);n?(e=t.substring(n.index+1),i=t.substring(0,n.index).split(/[~]/)):(i=t.split(/[~]/),e="");let r=0;t.startsWith(".")?s=[...this._history_path]:(r=-1,this._non_controller_path_prefix=i.shift(),""===this._non_controller_path_prefix&&(this._non_controller_path_prefix="/"),s=[]);for(let t of i)".."===t?s.pop():"*"===t?this._history_path.length>s.length&&s.push(this._history_path[s.length]):"."!==t&&""!==t&&s.push(t);if(0!==i.length&&i.at(-1)!==s.at(-1)&&(r=0),0===s.length&&""!==this.default_controller)return this._handleUrl(`~${this.default_controller}`);t=this._non_controller_path_prefix+"~"+s.join("~"),e=this._parseArgs(e,s.length);let o=[];r+=s.length;for(const[t,i]of Object.entries(this._previous_args)){let s=t.split(".");!e.hasOwnProperty(t)&&(1===s.length||parseInt(s[0])<=r)&&(e[t]=i)}for(const[t,i]of Object.entries(e))o.push(`${t}=${i}`);o.length>0&&(t+="~&"+o.join("&"));let a=`${window.location.protocol}//${window.location.host}${t}`,l=s.map((t=>`.navigation-links.nav-family-${t}`));return{contentName:s.at(-1),args:e,path:s,buttonSelector:l,url:a,href:t}}_parseArgs(e,i=null){if(!e||""===e)return{};let s={},n=e.split("&");for(var r=0;r<n.length;r++){let e=n[r].split("="),o=e.shift();i&&o.split(".").length<2&&(o=`${i}.${o}`);let a=e.join("=");s.hasOwnProperty(o)&&console.error("Duplication of url params: "+o),s[o]=(0,t.checkIfParamNumberBoolOrString)(decodeURIComponent(a))}return s}_manageDefault(t){const e=t.find(`.${i}`).data("default-controller");return!!e&&(this._pushState(`.~${e}`,!0),!0)}_pushState(t,e=!0){if(this._is_processing)return void this._process_queue.push([t,e]);let i=this._handleUrl(t);e?history.pushState(i,"",i.url):this.navigateToPage(i.path,i.args,i)}login(){location.reload()}logout(){this.login()}}t.app.register(SdcNavigatorController),function(e){function updateStateFunc(i){let s=e[i];e[i]=function(n,r,o){let a=Array.apply(null,arguments);if("function"==typeof e["on"+i.toLowerCase()]&&e["on"+i.toLowerCase()]({state:n}),t.trigger.apply(t.app.events,["navigateToPage",n.path,n.args,n]),"function"==typeof s)return s.apply(e,a)}}updateStateFunc("replaceState"),updateStateFunc("pushState"),updateStateFunc("popState"),window.onpopstate=function(t){e.popState(t.state)}}(window.history),SdcNavigatorController.prototype._on_init_params=function(){return["defaultController"]}})();